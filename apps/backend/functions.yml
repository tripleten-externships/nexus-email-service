index:
  name: TRIPLETEN-${sls:stage}-index
  handler: serverless.handler
  events:
    - http:
        method: get
        path: /
        documentation: ${file(docs/endpoints/index.doc.yml)}
        cors:
          origin: '*'
          headers:
            - Content-Type
            - Authorization
            - X-ApiVersion
            - X-AppVersion
            - X-BundleVersion
            - X-Platform
            - X-OSVersion
            - DeviceId
            - X-DeviceId
            - X-DeviceName
sendGridHook:
  name: TRIPLETEN-${sls:stage}-sendGridHook
  handler: serverless.handler
  environment:
    SENDGRID_LOCAL_QUEUE_URL: ${ssm:${sls:stage}-send_grid_sqs_url, 'http://127.0.0.1:9324/queue/SendGridLocalQueue.fifo'}
    SENDGRID_LOCAL_QUEUE_ARN: ${ssm:${sls:stage}-send_grid_sqs_arn, 'arn:aws:sqs:us-east-1:000000000000:SendGridLocalQueue.fifo'}
  iamRoleStatementsInherit: true
  iamRoleStatements:
    - Effect: Allow
      Action:
        - sqs:SendMessage
        - sqs:ReceiveMessage
        - sqs:DeleteMessage
        - sqs:GetQueueAttributes
      Resource: '*'
  events:
    - http:
        method: post
        path: webhook/sendgrid
