index:
  name: TRIPLETEN-${sls:stage}-index
  handler: serverless.handler
  events:
    - http:
        method: get
        path: /
        documentation: ${file(docs/endpoints/index.doc.yml)}
        cors:
          origin: '*'
          headers:
            - Content-Type
            - Authorization
            - X-ApiVersion
            - X-AppVersion
            - X-BundleVersion
            - X-Platform
            - X-OSVersion
            - DeviceId
            - X-DeviceId
            - X-DeviceName
# sendGridWebhookReceiver:
#   name: TRIPLETEN-${sls:stage}-sendGridWebhookReceiver
#   handler: serverless.handler
#   environment:
#     SENDGRID_EVENTS_QUEUE_URL: ${ssm:${sls:stage}-send_grid_sqs_url}
#     SENDGRID_QUEUE_ARN: ${ssm:${sls:stage}-send_grid_sqs_arn}
#   iamRoleStatementsInherit: true
#   iamRoleStatements:
#     - Effect: Allow
#       Action:
#         - sqs:ReceiveMessage
#         - sqs:DeleteMessage
#         - sqs:GetQueueAttributes
#         - sqs:SendMessage
#       Resource: ${self:provider.environment.SENDGRID_QUEUE_ARN}
#   events:
#     - http:
#         method: post
#         path: webhook/sendgrid
# processSendGridEventsTask:
#   name: TRIPLETEN-${sls:stage}-processSendGridEvents
#   handler: serverless.processSendGridEventsTask
#   timeout: 120
#   environment:
#     SENDGRID_QUEUE_ARN: ${ssm:${sls:stage}-send_grid_sqs_arn}
#   iamRoleStatementsInherit: true
#   iamRoleStatements:
#     - Effect: Allow
#       Action:
#         - sqs:ReceiveMessage
#         - sqs:DeleteMessage
#         - sqs:GetQueueAttributes
#         - sqs:SendMessage
#       Resource: ${self:provider.environment.SENDGRID_QUEUE_ARN}
#   events:
#     - sqs:
#         arn: ${self:provider.environment.SENDGRID_QUEUE_ARN}
#         functionResponseType: ReportBatchItemFailures
#         batchSize: 10
